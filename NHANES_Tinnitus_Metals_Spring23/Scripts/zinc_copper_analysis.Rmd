---
title: "Zinc"
author: "Valerie Ingalls"
date: "2022-10-28"
output: html_document
---

```{r setup, include=FALSE}
library(foreign)
library(survey)
library(tidyverse)
library(stringr)
library(ggplot2)
library(nnet)
```


```{r import}
# grabbing our finalized data sheet from generated from our processing script earlier
df <- read.csv("../Data/processed_metal_data.csv")
```


```{r factorize}
# setting a var to factor and removing the csv artifact column
df$tinnitus_type <- as.factor(df$tinnitus_type)
df <- select(df, -X)
```


We next establish our design variable, which is part of the `survey` package. This will allow us to include the elements of the complex survey design in our statistical analyses for better generalization to the population level.
```{r design}
tinnitus_design <- svydesign(data = df, id = ~psu, strata = ~stratum, weights = ~combined_subsample_weight, nest = TRUE)
```


Multiple linear regression models here. Running separate models with zinc and copper as outcome variables and using transformed  values. 
```{r multiple_lin_reg}
lmzn <- svyglm(normedZinc ~ tinnitus_type + age_group + ethnicity + sex + speech_in_noise, design = tinnitus_design)
summary(lmzn)


lmcu <- svyglm(normedCopper ~ tinnitus_type + age_group + ethnicity + sex + speech_in_noise, design = tinnitus_design)
summary(lmcu)

```

We will also perform multinomial logistic regression in order to see our tinnitus variable as an outcome rather than a predictor
```{r multinomial_logit_reg}
#We define the regression model using the weights from the survey design
logitzn <- multinom(tinnitus_type ~ normedZinc + age_group + ethnicity + sex + speech_in_noise, data = df, weights = tinnitus_design$prob.weights)

summary(logitzn)



logitcu <- multinom(tinnitus_type ~ normedCopper + age_group + ethnicity + sex + speech_in_noise, data = df, weights = tinnitus_design$prob.weights)

summary(logitcu)


```





```{r histograms}
# non-normalized density plots

ggplot(data = df) +
  geom_density(mapping = aes(x = zinc, weight = combined_subsample_weight, fill = tinnitus_type), alpha = .5) +
  geom_vline(xintercept = 61, color = "blue", linetype = 2) +
  scale_fill_discrete(labels = c("Chronic Bothersome Tinnitus", "Other Tinnitus", "No Tinnitus")) +
  labs(x = "Serum Zinc Level (\u03BCg/dL)", y = "Density", title = "Distribution of Serum Zinc Levels by Tinnitus Type", fill = "Tinnitus Type")
ggsave("../Output/Figures/Prelim_Zinc_Figure.png")


ggplot(data = df) +
  geom_density(mapping = aes(x = copper, weight = combined_subsample_weight, fill = tinnitus_type), alpha = .5) +
  geom_vline(xintercept = 63.7, color = "red", linetype = 2) +
  scale_fill_discrete(labels = c("Chronic Bothersome Tinnitus", "Other Tinnitus", "No Tinnitus")) +
  labs(x = "Serum Copper Level (\u03BCg/dL)", y = "Density", title = "Distribution of Serum Copper Levels by Tinnitus Type", fill = "Tinnitus Type")
ggsave("../Output/Figures/Prelim_Copper_Figure.png")

```






```{r}
ggplot(data = df) +
  geom_density(mapping = aes(x = normedZinc, weight = combined_subsample_weight, fill = tinnitus_type), alpha = .5) +
  #geom_vline(xintercept = 61, color = "blue", linetype = 2) +
  scale_fill_discrete(labels = c("Chronic Bothersome Tinnitus", "Other Tinnitus", "No Tinnitus")) +
  labs(x = "Serum Zinc Level (\u03BCg/dL)", y = "Density", title = "Distribution of Serum Zinc Levels by Tinnitus Type", fill = "Tinnitus Type")
ggsave("../Output/Figures/Prelim_Zinc_Figure_Normed.png")


ggplot(data = df) +
  geom_density(mapping = aes(x = normedCopper, weight = combined_subsample_weight, fill = tinnitus_type), alpha = .5) +
#  geom_vline(xintercept = 63.7, color = "red", linetype = 2) +
  scale_fill_discrete(labels = c("Chronic Bothersome Tinnitus", "Other Tinnitus", "No Tinnitus")) +
  labs(x = "Serum Copper Level (\u03BCg/dL)", y = "Density", title = "Distribution of Serum Copper Levels by Tinnitus Type", fill = "Tinnitus Type")
#ggsave("../Output/Figures/Prelim_Copper_Figure.png")
```










```{r chisq}
weighted_sextest <- svychisq(~tinnitus_type + sex, design = tinnitus_design)
weighted_sextest$observed
weighted_sextest


weighted_agetest <- svychisq(~tinnitus_type + age_group, design = tinnitus_design)
weighted_agetest$observed
weighted_agetest


weighted_ethtest <- svychisq(~tinnitus_type + ethnicity, design = tinnitus_design)
weighted_ethtest$observed
weighted_ethtest
```
